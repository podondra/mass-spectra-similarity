<!doctype html>
<head>
    <title>similarities</title>
    <meta charset="utf-8">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega/3.0.8/vega.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-lite/2.0.3/vega-lite.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vega-embed/3.0.0-rc7/vega-embed.js"></script>

    <style media="screen">
    /* add space between Vega-Embed links  */
    .vega-actions a {margin-right: 5px;}
    </style>
</head>
<body>
    <h1>found similarities</h1>
    <p>{{ similarities|length }} results</p>
    <p>time {{ time }} (second)</p>

    {% for similarity in similarities %}
    <h2>mass spectrum {{ loop.index }}</h2>
    <div id="viz-{{ loop.index }}"></div>
    <script>
	var vlspec = {
	    "$schema": "https://vega.github.io/schema/vega-lite/v2.json",
	    "data": {
		"values": {{ similarity['spectrum']|tojson|safe }}
	    },
	    "mark": "rule",
	    "encoding": {
		"x": {"field": "mz", "type": "quantitative"},
		"y": {"field": "intensity", "type": "quantitative"}
	    }
	};

	vegaEmbed("#viz-{{ loop.index }}", vlspec);
    </script>
    <ol>
        {% for peptide in similarity['peptides'] %}
        <li>{{ peptide }}: {{ similarity['mz'][loop.index0] }}</li>
        {% endfor %}
    </ol>

    {% endfor %}

</body>
